services:
  xray:
    image: docker.io/currycan/xray:25.9.1
    container_name: xray
    environment:
      - DOMAIN=$domain
      - CDNDOMAIN=$cdndomain
      - XUI_ACCOUNT=$domain
      - DECODE=$code
      - ACMESH_SERVER_NAME=letsencrypt
      - DEST_HOST=harvard.edu
      - LISTENING_PORT=443
      - DUFS_PATH_PREFIX=/myfiles
      - XUI_WEBBASEPATH=3xadmin
    ports:
      - '443:443/tcp'
      - '443:443/udp' # use UDP for usage of HTTP/3
    volumes:
      - ./data:/data
      - ./pki:/pki
      - ./acmecerts:/acmecerts
      - ./supervisord/:/etc/supervisord/
      - ./.xray:/.env
      - ./xray:/etc/xray/conf
      - ./v2ray:/etc/v2ray/
      - ./nginx/http:/etc/nginx/conf.d
      - ./nginx/tcp:/etc/nginx/stream.d
      - ./nginx/dhparam:/etc/nginx/dhparam
      - ./x-ui:/etc/x-ui/
      - ./dufs:/etc/dufs
      - ./logs/xray:/var/log/xray
      - ./logs/v2ray:/var/log/v2ray
      - ./logs/x-ui:/var/log/x-ui
      - ./logs/dufs:/var/log/dufs
      - ./logs/supervisor:/var/log/supervisor
      - ./logs/nginx:/var/log/nginx
    # working_dir: /etc/nginx
    restart: always
    tty: true
    network_mode: host
    ulimits:
      nproc: 65535
      nofile:
        soft: 65536
        hard: 65536
